DEFINE_IMPORT(FileName=C:\DE03 SYRINGE SCRIPT APP\RECIPES\SPOTITONV1.0\COMMON_POINTS.TXT)


DEFINE_IMPORT(FileName=C:\DE03 SYRINGE SCRIPT APP\RECIPES\SPOTITONV1.0\COMMON_VARIABLES.TXT)


DEFINE_IMPORT(FileName=C:\DE03 SYRINGE SCRIPT APP\RECIPES\SPOTITONV1.0\COMMON_IO.TXT)


' SET EVERYTHING TO DEFAULT VEL, ACC AND DECEL


SET_DEFAULT_MOTION_PARAMETERS(UseGridRobot=FALSE)


SET_DEFAULT_MOTION_PARAMETERS(UseGridRobot=TRUE)


' SET TO 1 IF YOU WANT TO FIRE WITH TRAPEZOID ELSE COS


DEFINE_VARIABLE(VariableName=USE_TRAPEZOID, _
 VariableType=INT, _
 VariableValue=1)


WHILE(MAIN_LOOP_1 = 1)


	GET_INTEGER_FROM_USER(VariableName=I1, _
	 Prompt=1=WASH WITH SONICATE\N2=ASPIRATE AND DAB SAMPLE\N3=INSPECT SIDE CAM\N4=DISPENSE ON COVER GLASS OR GRID\N5=MOVE SAFE            CANCEL=TO EXIT, _
	 MinValue=1, _
	 MaxValue=5, _
	 ValueIfUserCancels=-1)


	' SET SPEED FACTOR


	VARIABLE_SET(VariableName=SPEED_FACTOR, _
	 VariableValue=100)


	IF(I1 = -1)


		EXITSEQUENCE


	ENDIF


	' WASH WITH SONICATE


	IF(I1 = 1)


		GET_INTEGER_FROM_USER(VariableName=I2, _
		 Prompt=READY...MOVE TO WASH POINT \N[TURN ON VACUUM DRAIN]\N1=MOVE CANCEL=ABORT, _
		 MinValue=1, _
		 MaxValue=1, _
		 ValueIfUserCancels=-1)


		IF(I2 = -1)


			EXITSEQUENCE


		ENDIF


		IO_SET_OUTPUT(IONumber=OUT_WASH_ON)


		MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
		 Point=WASH_T1_PT, _
		 ZOffset=6, _
		 Speed_pct=SPEED_FACTOR, _
		 MoveToSafeHeightFirst=TRUE)


		GET_INTEGER_FROM_USER(VariableName=I3, _
		 Prompt=CONTINUE MOVING DOWN \N1=MOVE CANCEL=ABORT, _
		 MinValue=1, _
		 MaxValue=1, _
		 ValueIfUserCancels=-1)


		IF(I3 = -1)


			IO_SET_OUTPUT(IONumber=OUT_WASH_OFF)


			EXITSEQUENCE


		ENDIF


		MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
		 Point=WASH_T1_PT, _
		 ZOffset=-4, _
		 Speed_pct=25, _
		 MoveToSafeHeightFirst=FALSE)


		SYRINGE_SET_VALVE(SyringeMask=0, _
		 ValvePosition=0, _
		 DelayAfter_ms=100)


		SYRINGE_EMPTY(SyringeMask=0, _
		 SyringeSpeed=10, _
		 EmptyThroughTip=FALSE, _
		 DelayAfter_ms=50)


		ASPIRATE(SyringeMask=0, _
		 Volume_uL=100, _
		 SyringeSpeed=10, _
		 ValveToBypass=FALSE, _
		 AspFromReservoir=TRUE)


		DISPENSE(SyringeMask=0, _
		 Volume_uL=100, _
		 SyringeSpeed=16, _
		 ValveToBypass=FALSE, _
		 DelayAfter_ms=-1)


		' SPEED CODE 14-67 15-32 16-24


		FOR(I2 = 1 To 2 Step 1)


			DE03_STOP_WAVEFORM()


			DE03_COS_SETUP(Tip=1, _
			 DesiredFreq=40000, _
			 InBurstNo=20000, _
			 CosAmplitude=1800, _
			 StrobeDuration=1, _
			 StrobeDelay=0, _
			 NumOfBursts=1, _
			 TriggerSetting=0, _
			 TriggerDelay=100, _
			 TriggerPeriod=1)


			DE03_START_WAVEFORM(WaitForCompletion=FALSE, _
			 Timeout_ms=1000)


			PAUSE(UserMessage=40KHZ, _
			 PauseTime_ms=1000)


			DE03_STOP_WAVEFORM()


			DE03_COS_SETUP(Tip=1, _
			 DesiredFreq=60000, _
			 InBurstNo=30000, _
			 CosAmplitude=1800, _
			 StrobeDuration=1, _
			 StrobeDelay=0, _
			 NumOfBursts=1, _
			 TriggerSetting=0, _
			 TriggerDelay=100, _
			 TriggerPeriod=1)


			DE03_START_WAVEFORM(WaitForCompletion=FALSE, _
			 Timeout_ms=1000)


			PAUSE(UserMessage=60KHZ, _
			 PauseTime_ms=1000)


			DE03_STOP_WAVEFORM()


			DE03_COS_SETUP(Tip=1, _
			 DesiredFreq=80000, _
			 InBurstNo=40000, _
			 CosAmplitude=1800, _
			 StrobeDuration=1, _
			 StrobeDelay=0, _
			 NumOfBursts=1, _
			 TriggerSetting=0, _
			 TriggerDelay=100, _
			 TriggerPeriod=1)


			DE03_START_WAVEFORM(WaitForCompletion=FALSE, _
			 Timeout_ms=0)


			PAUSE(UserMessage=80KHZ, _
			 PauseTime_ms=1000)


		NEXT


		GET_INTEGER_FROM_USER(VariableName=I2, _
		 Prompt=WHEN SYRINGE IS DONE MOVING HIT 1 TO SWITCH VALVE TO BYPASS, _
		 MinValue=1, _
		 MaxValue=1, _
		 ValueIfUserCancels=-1)


		IF(I2 = 1)


			SYRINGE_SET_VALVE(SyringeMask=0, _
			 ValvePosition=2, _
			 DelayAfter_ms=1000)


			PAUSE(UserMessage=ALLOWING PRESSURE TO EQUALIZE, _
			 PauseTime_ms=5000)


		ENDIF


		' COME OUT OF WASH SLOW AND TURN OFF THE PUMP


		MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
		 Point=WASH_T1_PT, _
		 ZOffset=6, _
		 Speed_pct=25, _
		 MoveToSafeHeightFirst=FALSE)


		IO_SET_OUTPUT(IONumber=OUT_WASH_OFF)


	ENDIF


	' ASPIRATE SAMPLE (NEED TO CHANGE THIS TO I1=2 AND DEBUG)


	IF(I1 = 2)


		VARIABLE_SET(VariableName=TUBE_COL_0_TO_3, _
		 VariableValue=0)


		VARIABLE_SET(VariableName=TUBE_ROW_0_TO_3, _
		 VariableValue=0)


		VARIABLE_SET(VariableName=DAB_USE_DAB, _
		 VariableValue=FALSE)


		VARIABLE_SET(VariableName=DAB_COL_0_TO_8, _
		 VariableValue=2)


		VARIABLE_SET(VariableName=DAB_ROW_0_TO_8, _
		 VariableValue=4)


		MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
		 Point=TUBES_T1_PT_ARRAY[TUBE_COL_0_TO_3,TUBE_ROW_0_TO_3], _
		 XOffset=50, _
		 ZOffset=15, _
		 Speed_pct=SPEED_FACTOR, _
		 MoveToSafeHeightFirst=TRUE)


		MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
		 Point=TUBES_T1_PT_ARRAY[TUBE_COL_0_TO_3,TUBE_ROW_0_TO_3], _
		 ZOffset=1.5, _
		 Speed_pct=SPEED_FACTOR, _
		 MoveToSafeHeightFirst=FALSE)


		GET_INTEGER_FROM_USER(VariableName=I2, _
		 Prompt=1=OK TO MOVE INTO WELL\NCANCEL=ABORT, _
		 MinValue=1, _
		 MaxValue=1, _
		 ValueIfUserCancels=-1)


		IF(I2 = -1)


			EXITSEQUENCE


		ENDIF


		MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
		 Point=TUBES_T1_PT_ARRAY[TUBE_COL_0_TO_3,TUBE_ROW_0_TO_3], _
		 ZOffset=-5, _
		 Speed_pct=15, _
		 MoveToSafeHeightFirst=FALSE)


		ASPIRATE(SyringeMask=0, _
		 Volume_uL=5, _
		 SyringeSpeed=20, _
		 ValveToBypass=FALSE, _
		 AspFromReservoir=FALSE)


		PAUSE(UserMessage=NONE, _
		 PauseTime_ms=3000)


		SYRINGE_SET_VALVE(SyringeMask=0, _
		 ValvePosition=2, _
		 DelayAfter_ms=5000)


		MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
		 Point=TUBES_T1_PT_ARRAY[TUBE_COL_0_TO_3,TUBE_ROW_0_TO_3], _
		 ZOffset=6, _
		 Speed_pct=15, _
		 MoveToSafeHeightFirst=FALSE)


		IF(DAB_USE_DAB = TRUE)


			MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
			 Point=DAB_T1_PT_ARRAY[DAB_COL_0_TO_8,DAB_ROW_0_TO_8], _
			 ZOffset=1.5, _
			 Speed_pct=SPEED_FACTOR, _
			 MoveToSafeHeightFirst=FALSE)


			GET_INTEGER_FROM_USER(VariableName=I2, _
			 Prompt=1=OK TO MOVE ONTO DAB\NCANCEL=ABORT, _
			 MinValue=1, _
			 MaxValue=1, _
			 ValueIfUserCancels=-1)


			IF(I2 = -1)


				EXITSEQUENCE


			ENDIF


			MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
			 Point=DAB_T1_PT_ARRAY[DAB_COL_0_TO_8,DAB_ROW_0_TO_8], _
			 Speed_pct=15, _
			 MoveToSafeHeightFirst=FALSE)


			PAUSE(UserMessage=NONE, _
			 PauseTime_ms=300)


			MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
			 Point=DAB_T1_PT_ARRAY[DAB_COL_0_TO_8,DAB_ROW_0_TO_8], _
			 XOffset=0.1, _
			 Speed_pct=10, _
			 MoveToSafeHeightFirst=FALSE)


			PAUSE(UserMessage=NONE, _
			 PauseTime_ms=3000)


			MOVE_TO_SAFE_HEIGHT(Speed_pct=25)


		ELSE


			MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
			 Point=TUBES_T1_PT_ARRAY[TUBE_COL_0_TO_3,TUBE_ROW_0_TO_3], _
			 XOffset=50, _
			 ZOffset=6, _
			 Speed_pct=SPEED_FACTOR, _
			 MoveToSafeHeightFirst=FALSE)


		ENDIF


	ENDIF


	' INSPECT WITH SIDE CAMERA


	IF(I1 = 3)


		MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
		 Point=INS_T1_PT, _
		 ZOffset=0, _
		 Speed_pct=50, _
		 MoveToSafeHeightFirst=TRUE)


		VARIABLE_SET(VariableName=INNER_LOOP_1, _
		 VariableValue=1)


		WHILE(INNER_LOOP_1 = 1)


			GET_INTEGER_FROM_USER(VariableName=INNER_LOOP_1, _
			 Prompt=1=FIRE, _
			 MinValue=1, _
			 MaxValue=1, _
			 ValueIfUserCancels=-1)


			IF(INNER_LOOP_1 = 1)


				DE03_STOP_WAVEFORM()


				IF(USE_TRAPEZOID = 1)


					DE03_TRAP_SETUP(Tip=1, _
					 Leading=3, _
					 Dwell=15, _
					 Trailing=10, _
					 TrapDrops=500, _
					 TrapFreq=300, _
					 TrapAmp=550, _
					 StrobeDuration=1, _
					 StrobeDelay=150, _
					 TriggerSetting=0, _
					 TriggerDelay=1000000, _
					 TriggerPeriod=1)


				ELSE


					DE03_COS_SETUP(Tip=1, _
					 DesiredFreq=12750, _
					 InBurstNo=100, _
					 CosAmplitude=300, _
					 StrobeDuration=1, _
					 StrobeDelay=0, _
					 NumOfBursts=1, _
					 TriggerSetting=0, _
					 TriggerDelay=100, _
					 TriggerPeriod=1)


				ENDIF


				DE03_START_WAVEFORM(WaitForCompletion=FALSE, _
				 Timeout_ms=1000)


			ENDIF


		LOOP


		MOVE_TO_SAFE_HEIGHT(Speed_pct=30)


	ENDIF


	' DISPENSE ONTO COVER GLASS,  SET FIRE_ON_COVERGLASS=1


	' TO FIRE ONTO THE GRID, SET  FIRE_ON_COVERGLASS=0


	VARIABLE_SET(VariableName=FIRE_ON_COVERGLASS, _
	 VariableValue=0)


	IF(I1 = 4)


		GET_INTEGER_FROM_USER(VariableName=FIRE_ON_COVERGLASS, _
		 Prompt=0=FIRE ONTO GRID  \N1=FIRE ONTO COVER GLASS\N2=FIRE AS IS, _
		 MinValue=0, _
		 MaxValue=2, _
		 ValueIfUserCancels=1)


		MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
		 Point=SAFE_T1_PT, _
		 Speed_pct=SPEED_FACTOR, _
		 MoveToSafeHeightFirst=TRUE)


		ROTATE_MOVE(PositionCount=ROTATE_90)


		' FIRE ON GRID OTPION


		IF(FIRE_ON_COVERGLASS = 0)


			IO_SET_OUTPUT(IONumber=OUT_COVERGLASS_RETRACT)


			IO_WAIT_INPUT(IONumber=IN_COVERGLASS_RETRACT_SEN, _
			 TimeOut_ms=4000)


			MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
			 Point=SAFE_PT_GRIDROBOT, _
			 Speed_pct=SPEED_FACTOR, _
			 MoveToSafeHeightFirst=TRUE, _
			 UseGridRobot=TRUE)


			MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
			 Point=CAMERA_PT_GRIDROBOT, _
			 Speed_pct=SPEED_FACTOR, _
			 MoveToSafeHeightFirst=TRUE, _
			 UseGridRobot=TRUE)


		ENDIF


		' FIRE ON COVERGLASS OPTION


		IF(FIRE_ON_COVERGLASS = 1)


			MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
			 Point=SAFE_PT_GRIDROBOT, _
			 Speed_pct=SPEED_FACTOR, _
			 MoveToSafeHeightFirst=TRUE, _
			 UseGridRobot=TRUE)


			IO_SET_OUTPUT(IONumber=OUT_COVERGLASS_EXTEND)


		ENDIF


		MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
		 Point=COVERGLASS_T1_PT, _
		 XOffset=15, _
		 Speed_pct=SPEED_FACTOR, _
		 MoveToSafeHeightFirst=TRUE)


		MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
		 Point=COVERGLASS_T1_PT, _
		 Speed_pct=SPEED_FACTOR, _
		 MoveToSafeHeightFirst=FALSE)


		DE03_STOP_WAVEFORM()


		IF(USE_TRAPEZOID = 1)


			DE03_TRAP_SETUP(Tip=1, _
			 Leading=3, _
			 Dwell=15, _
			 Trailing=10, _
			 TrapDrops=5, _
			 TrapFreq=300, _
			 TrapAmp=550, _
			 StrobeDuration=1, _
			 StrobeDelay=1, _
			 TriggerSetting=0, _
			 TriggerDelay=1000000, _
			 TriggerPeriod=1)


		ELSE


			DE03_COS_SETUP(Tip=1, _
			 DesiredFreq=12350, _
			 InBurstNo=2, _
			 CosAmplitude=650, _
			 StrobeDuration=1, _
			 StrobeDelay=0, _
			 NumOfBursts=1, _
			 TriggerSetting=0, _
			 TriggerDelay=100, _
			 TriggerPeriod=1)


		ENDIF


		' SET LOW ACCELERATION / DECEL FOR SHORT DISPENSE MOVES Y AND Z AXIS


		SET_ACCEL(AxisNumber=1, _
		 Accel=200)


		SET_ACCEL(AxisNumber=2, _
		 Accel=200)


		VARIABLE_SET(VariableName=Z_OFFSET_GRID, _
		 VariableValue=0.0)


		FOR(I2 = 0 To 2 Step 1)


			VARIABLE_SET(VariableName=Y_OFFSET_GRID, _
			 VariableValue=0.0)


			FOR(I3 = 0 To 2 Step 1)


				MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
				 Point=COVERGLASS_T1_PT, _
				 YOffset=Y_OFFSET_GRID, _
				 ZOffset=Z_OFFSET_GRID, _
				 Speed_pct=10, _
				 MoveToSafeHeightFirst=FALSE)


				PAUSE(UserMessage=NONE, _
				 PauseTime_ms=500)


				DE03_START_WAVEFORM(WaitForCompletion=FALSE, _
				 Timeout_ms=1000)


				PAUSE(UserMessage=NONE, _
				 PauseTime_ms=500)


				VARIABLE_MATH(Y_OFFSET_GRID = Y_OFFSET_GRID + YINC_GRID)


			NEXT


			VARIABLE_MATH(Z_OFFSET_GRID = Z_OFFSET_GRID + ZINC_GRID)


		NEXT


		MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
		 Point=COVERGLASS_T1_PT, _
		 XOffset=15, _
		 Speed_pct=SPEED_FACTOR, _
		 MoveToSafeHeightFirst=FALSE)


		MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
		 Point=SAFE_T1_PT, _
		 Speed_pct=SPEED_FACTOR, _
		 MoveToSafeHeightFirst=TRUE)


		ROTATE_MOVE(PositionCount=ROTATE_0)


		SET_DEFAULT_MOTION_PARAMETERS(UseGridRobot=FALSE)


	ENDIF


	IF(I1 = 5)


		MOVE_TO_SAFE_HEIGHT(Speed_pct=25)


		MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
		 Point=SAFE_T1_PT, _
		 Speed_pct=SPEED_FACTOR, _
		 MoveToSafeHeightFirst=FALSE)


		ROTATE_MOVE(PositionCount=ROTATE_0)


		MOVE_TO_SAFE_HEIGHT(Speed_pct=25, _
		 UseGridRobot=TRUE)


		MOVE_TO_POINT(Tool=SYSTEM_TIP1, _
		 Point=SAFE_PT_GRIDROBOT, _
		 Speed_pct=SPEED_FACTOR, _
		 MoveToSafeHeightFirst=FALSE, _
		 UseGridRobot=TRUE)


	ENDIF


LOOP


